# mermaidEdit 产品需求文档

## 1. 产品概述

### 1.1 产品定位

一个简洁美观的在线 mermaid 图表编辑器，专注于提供高效的图表创建体验。

### 1.2 目标用户

- 技术人员：需要快速创建技术文档中的图表
- 产品经理：需要制作流程图、时序图等
- 学生和教育工作者：需要制作教学图表

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 图表编辑

- **代码编辑器**
  - 基础文本编辑功能，用户在此处输入符合 mermaid 格式要求的内容
  - 自动格式化内容

#### 实时预览

- **实时预览**
  - 实时渲染图表
  - 支持图表缩放（鼠标滚轮 + 按钮控制）
  - 支持图表拖拽移动
  - 支持图表重置视图

#### 列表展示

- **图表列表**
  - 以列表展示用户已保存的图表
  - 列表中需展示以下内容：
    - 图表名称（最多 20 个字）
    - 创建时间
    - 更新时间
  - 对于当前选中的应有标识
  - 点击后加载对应的图表
  - 列表按创建时间倒序排列

#### 2.1.3 数据持久化

- **本地存储**
  - 使用 IndexedDB 作为主要存储方案
  - 自动保存编辑内容到本地

#### 2.1.4 导出功能

- **导出选项**
  - PNG 导出（无背景，透明背景）
  - SVG 导出（无背景）
  - 支持设置导出文件名（默认：chart-[timestamp]）
  - 导出时包含图表样式

### 2.2 用户体验

#### 2.2.1 界面设计

- **整体风格**
  - 简洁美观的界面设计

- **布局结构**

- 左侧：图表列表区域
- 中间：代码编辑区域
- 右侧：实时预览区域

#### 2.2.2 交互设计

- **加载状态**
  - 骨架屏加载
  - 进度条显示
  - 友好的错误提示

- **操作反馈**
  - 按钮点击有视觉反馈
  - 成功操作显示 toast 提示
  - 错误操作显示错误提示

## 3. 技术规范

### 3.1 技术栈

- **前端框架**：React
- **样式框架**：Tailwind CSS
- **图表渲染**：mermaid.js 最新版本
- **本地存储**：IndexedDB（通过 idb 库）

### 3.2 浏览器兼容性

- Chrome  100 +

### 3.4 部署要求

- 支持使用静态资源服务器部署

## 4. 数据结构设计

### 4.2 统一存储结构（IndexedDB）

**存储键值设计：**

- `chart:{uuid}` -> ChartData（图表数据）

**ChartData 结构：**

- 图表 id，使用 uuid
- 图表名称
- 内容，记录编辑器中的 mermaid 内容
- 创建时间
- 更新时间

## 5. 错误处理策略

### 5.1 核心原则

- **优雅降级**：功能失败时不影响核心编辑体验
- **明确反馈**：用户始终知道发生了什么
- **数据安全**：永不丢失用户数据

### 5.2 具体策略

**存储错误：**

- IndexedDB 失败时显示警告，但允许继续编辑
- 提供手动导出功能作为备份

**渲染错误：**

- Mermaid 语法错误时显示具体错误位置
- 保持编辑器可用，不阻断用户输入
